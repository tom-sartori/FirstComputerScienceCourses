#include <stdio.h> 
#include <stdlib.h>
#include <fcntl.h> // open
#include <unistd.h> // read / write

void codage(int argc, char ** argv); 
void deCodage(int argc, char ** argv); 

int main(int argc, char ** argv) {
	codage(argc, argv); 

}

void codage(int argc, char ** argv) {
	if (argc != 4) {printf("Erreur d'argument\n"); exit(1); }

	int fdd = open(argv[1], O_RDONLY); 
	if (fdd < 0) {perror(argv[1]); exit(1); }

	int fda = open(argv[2], O_CREAT | O_WRONLY, 0644); 
	if (fdd <0) {perror(argv[2]); exit(1); }

	int cle = atoi(argv[3]); 

	int nbLus = -1; 
	char *source = malloc(sizeof(char)); 
	char ch; 
	char *arrivee = malloc(sizeof(char)); 

	while (nbLus != 0) {
		nbLus = read(fdd, source, 1); 

		ch = *source; 

		if (65 <= ch && ch <= 90) {
			ch = ch + cle%26; 
			if (ch > 90) 
				ch = ch - 26; 
		}
		else if (97 <= ch && ch <= 122) {
			ch = ch + cle%26; 
			if (ch > 122) 
				ch = ch - 26; 
		}

		*arrivee = ch; 
		write(fda, arrivee, 1); 

	}
	close(fdd); 
	close(fda); 
}
void deCodage(int argc, char ** argv) {
	if (argc != 3) {printf("Erreur d'argument\n"); exit(1); }

	int fdd = open(argv[1], O_RDONLY); 
	if (fdd < 0) {perror(argv[1]); exit(1); }

	int fda = open(argv[2], O_CREAT | O_WRONLY, 0644); 
	if (fdd <0) {perror(argv[2]); exit(1); }

	int cle = atoi(argv[3]); 

	int nbLus = -1; 
	char *source = malloc(sizeof(char)); 
	char ch; 
	char *arrivee = malloc(sizeof(char)); 

	while (nbLus != 0) {
		nbLus = read(fdd, source, 1); 

		ch = *source; 

		if (65 <= ch && ch <= 90) {
			ch = ch - cle%26; 
			if (ch < 65) 
				ch = ch + 26; 
		}
		else if (97 <= ch && ch <= 122) {
			ch = ch - cle%26; 
			if (ch < 97) 
				ch = ch + 26; 
		}

		*arrivee = ch; 
		write(fda, arrivee, 1); 
	}
	close(fdd); 
	close(fda); 
}
