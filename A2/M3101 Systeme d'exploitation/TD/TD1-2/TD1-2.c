#include <stdio.h> 
#include <stdlib.h>
#include <fcntl.h> // open
#include <unistd.h> // read / write

void ex1 (); 
void ex2 (int argc, char ** argv); 
void codage (int argc, char ** argv); 
void decodage (int argc, char ** argv); 



int main(int argc, char **argv) {

	decodage(argc, argv); 	

}



void ex1 () {

	int ch = getchar(); 

	while(ch != EOF) {
		if (ch == 'z') 
			ch = 'a';
		else if (ch == 'Z')
			ch = 'A'; 
		else
			ch ++; 

		putchar(ch);
		ch = getchar(); 
	}
	printf("\n"); 
}



void ex2 (int argc, char ** argv) {

	if (argc != 2) { printf("Erreur d'argument\n"); exit(1); }

	int fdd = open(argv[1], O_RDWR); 
	if (fdd < 0) { perror(argv[1]); exit(1); }

	char *s = malloc(sizeof(char)); 
	char ch; 
	int nbLus = read(fdd, s, 1); 

	while(nbLus != 0) { 
		ch = *s; 

		
		if ( (65 <= ch && ch <= 90 ) || (97 <= ch && ch <= 122) ) {

			if (ch == 'z') 
				ch = 'a';
			else if (ch == 'Z')
				ch = 'A'; 
			else
				ch ++; 	
		}

		printf("%c", ch);

		nbLus = read(fdd, s, 1);
	}
	printf("\n"); 
	close(fdd); 
}



void codage (int argc, char ** argv) {

	if (argc != 3) { printf("Erreur d'argument\n"); exit(1); }

	int fdd = open(argv[1], O_RDWR); 
	if (fdd < 0) { perror(argv[1]); exit(1); }

	char *code = argv[2]; 
	int tailleCode = 0; 
	while (code[tailleCode] != '\0') 
		tailleCode ++; 
	int i = 0; 
	char lettreCode; 


	char *s = malloc(sizeof(char)); 
	char ch; 
	int nbLus = read(fdd, s, 1); 


	while (nbLus != 0) {
		if (i == tailleCode)
			i = 0; 
		ch = *s; 


		ch = ch + code[i]%65; 
		if (ch > 90)
			ch = ch - 26; // ch = 60 + (ch - 90); 

		printf("%c", ch);


		i++; 
		nbLus = read(fdd, s, 1); 
	}
	printf("\n");
	close(fdd); 
}



void decodage (int argc, char ** argv) {

	if (argc != 3) { printf("Erreur d'argument\n"); exit(1); }

	int fdd = open(argv[1], O_RDWR); 
	if (fdd < 0) { perror(argv[1]); exit(1); }

	char *code = argv[2]; 
	int tailleCode = 0; 
	while (code[tailleCode] != '\0') 
		tailleCode ++; 
	int i = 0; 
	char lettreCode; 


	char *s = malloc(sizeof(char)); 
	char ch; 
	int nbLus = read(fdd, s, 1); 


	while (nbLus != 0) {
		if (i == tailleCode)
			i = 0; 
		ch = *s; 


		ch = ch - code[i] + 65; 
		if (ch < 65)
			ch = 26 + ch; // ch = 90 - (64 - ch); 

		printf("%c", ch);


		i++; 
		nbLus = read(fdd, s, 1); 
	}
	printf("\n");
	close(fdd); 
}
